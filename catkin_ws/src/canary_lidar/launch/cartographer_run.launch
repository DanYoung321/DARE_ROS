<!-- 
  Main Cartographer launch file
  
  Used to:

  1- Load the URDF configuration file
  2- Start the robot state publisher for transforms
  3- Start the Cartographer node to begin SLAM along with LUA config file
  4- Start RViz for visualization
  5- Play the specified bag file

  -->

<launch>
  <!-- Load the URDF configuration file 
  <param name="robot_description"
    textfile="$(find cartographer_ros)/urdf/backpack_2d.urdf" /> -->

  <!-- Start the robot state publisher  (For transforms)
  <node name="robot_state_publisher" pkg="robot_state_publisher"
    type="robot_state_publisher" /> -->

  <!-- Start the Cartographer node to begin SLAM along with LUA config file-->
  <node name="cartographer_node" pkg="cartographer_ros"
      type="cartographer_node" args="
          -configuration_directory $(find canary_lidar)/config
          -configuration_basename canary.lua"
      output="screen">
    <remap from="echoes" to="horizontal_laser_2d" />
  </node>

  <!-- Start RViz for visualization -->
  <node name="rviz" pkg="rviz" type="rviz" required="true"
        args="-d $(find canary_lidar)/config/lidar_rviz_config.rviz"/>

  <!-- Bag file to use with Cartographer -->
  <arg name="bag_filename" default="$(find canary_lidar)/bag/lidar_scan_data.bag"/>

  <!-- Use the simulation time -->
  <param name="/use_sim_time" value="true" />
  
  <!-- Play the specified bag file -->
  <node name="playbag" pkg="rosbag" type="play"
        args="--clock -l $(arg bag_filename)" />
</launch>